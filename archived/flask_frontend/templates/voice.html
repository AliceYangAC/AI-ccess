{% extends "layout.html" %}
{% block content %}
<h2>üéõÔ∏è Voice-Controlled Dashboard</h2>
<button onclick="startListening()" class="btn btn-primary mb-3">üéôÔ∏è Speak Command</button>
<p><strong>Heard:</strong> <span id="transcript"></span></p>
<div id="uiPreview" class="p-3 border rounded">
  <p>Theme: <span id="theme">Light</span></p>
  <p>Layout: <span id="layout">Default</span></p>
  <p>Font Size: <span id="fontSize">Default</span></p>
  <p>Navigation: <span id="navigation">Manual</span></p>
</div>


<script>
function startListening() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.start();

  recognition.onresult = async function(event) {
    const text = event.results[0][0].transcript;
    document.getElementById("transcript").textContent = text;

    const res = await fetch("/dashboard-intent", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ command_text: text })
    });
    const result = await res.json();

    if (result.action === "update_ui") {
      document.getElementById("theme").textContent = result.theme;
      document.body.className = result.theme === "dark" ? "bg-dark text-white" : "bg-light";
    }
    if (result.action === "navigate") {
      document.getElementById("layout").textContent = result.target;
    }
  };
}
</script>
{% endblock %}
